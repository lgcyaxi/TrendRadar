# Changelog v5.0.x

**Release Period**: 2026-01-14 ~ 2026-01-16

## Overview

The 5.0.x series introduces the extension plugin system, rolling window storage architecture, and several notification enhancements.

---

## v5.0.7 - Wework Compact AI Prompt Update (2026-01-16)

Updated the wework_compact extension's AI prompt to generate **journalistic news briefs** (200-300 characters, 2-3 sentences) that summarize the key events of the day.

### Changed
- AI prompt now generates journalistic news briefs instead of theme summaries
- Role changed from "新闻摘要专家" to "新闻编辑"

### Added
- New `ai_summary` config options: `target_length`, `tone`, `focus`, `style`

---

## v5.0.6 - Extension Fixes (2026-01-16)

Fixes two extension behaviors: notification_scheduler push_window bypass logic and wework_compact output format.

### Fixed
- notification_scheduler: Only bypass push_window when scheduler returns non-empty channel list
- wework_compact: Rewrote output format to summary + bullet-pointed list
- wework_compact: Now filters to show only **new titles** instead of all matched titles

---

## v5.0.5 - WeWork Compact Notification Extension (2026-01-16)

Introduces a new `wework_compact` extension that transforms verbose notification messages into a compact format.

### Added
- **WeWork Compact Extension** (`extensions/wework_compact/`)
  - AI-powered summary generation using existing AI_ANALYSIS config
  - Compact format combining multiple news items into single message
  - Platform normalization (weibo→微博, douyin→抖音, etc.)
  - Fallback mode when AI unavailable

---

## v5.0.4 - Rolling Window Database Architecture (2026-01-16)

Introduces a new Rolling Window storage architecture with hot/cold data separation.

### Added
- **Rolling Window Storage Backend**
  - `current.db` - Hot data (recent N days, default: 7)
  - `archive.db` - Cold data (older records)
  - SQL query optimization reducing memory usage by ~10x
  - Automatic maintenance (migration, cleanup, VACUUM)

- **Configuration Options**
  ```yaml
  storage:
    rolling_window:
      enabled: false
      hot_days: 7
      archive_retention_days: 90 # Days to keep in archive.db (0=forever)
      auto_maintenance: true
  ```

- **Migration Tool**: `scripts/migrate_to_rolling_window.py`

### Schema Changes
- Added `crawl_date` column to `news_items` and `rss_items` tables
- Added `db_metadata` table for tracking database info

---

## v5.0.3 - ChannelFilter Extension & Notification Scheduler (2026-01-15)

New ChannelFilter extension point and notification scheduler plugin for time-based notification channel filtering.

### Added
- **ChannelFilter Extension Point** (`extensions/base.py`)
  - Filter notification channels before sending
  - Returns 3-tuple: `(enabled_channels, channel_overrides, frequency_words_path)`

- **Notification Scheduler Plugin** (`extensions/notification_scheduler/`)
  - Time-based notification scheduling with platform filtering
  - ±5 minute time tolerance (configurable)
  - Custom frequency_words per schedule
  - Email recipient override per schedule

### Changed
- notification_scheduler bypasses `push_window` checks when matched
- Added loguru log level configuration

---

## v5.0.2 - Documentation Reorganization (2026-01-14)

Documentation reorganization and naming convention improvements.

### Added
- New changelog structure with version-based files
- `docs/changelog/` directory

### Changed
- Renamed `docs/extensions.md` → `docs/README-EXTENSIONS.md`
- Renamed `docs/nas/DEPLOYMENT.md` → `docs/SYNOLOGY-NAS-DEPLOYMENT.md`

---

## v5.0.1 - Extension Plugin System (2026-01-14)

Introduces the extension plugin system and enhances report deduplication.

### Added
- Extension plugin system with entry points support
- Report deduplication extension plugin with multi-platform URL support
- Enhanced logging with loguru
- Clickable source links for multi-platform news in HTML reports

### Changed
- Updated default Ollama model to qwen2.5:14b-instruct
- Normalized configuration keys to lowercase convention

### Fixed
- Crawler execution mode configuration (RUN_MODE environment variable)
- Report deduplication logic for better accuracy

---

## Migration Notes

1. Update extension config keys to lowercase
2. Rolling window mode is disabled by default - enable when ready
3. Migration tool available: `python scripts/migrate_to_rolling_window.py --backup`

## Files Changed (Major)

| File | Description |
|------|-------------|
| `trendradar/storage/local.py` | RollingWindowLocalBackend class |
| `trendradar/storage/manager.py` | Rolling window backend support |
| `extensions/notification_scheduler/` | Time-based notification scheduling |
| `extensions/wework_compact/` | Compact notification format |
| `extensions/base.py` | ChannelFilter extension point |
